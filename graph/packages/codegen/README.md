# @narratorai/graph-codegen

Introspects our Graph and generates TS defintions

> NOTE: this package currently introspects graph as a _user_
> Accessing as _admin_ would give a much broader schema

## Schema generation

Within the `graph` repo, this package is used to introspect the graphql schema and generate type definitions.

This schema is baked into the released package.

## Project code generation

Within a project, this package can be installed:

```shell
yarn add @narratorai/graph-codegen
```

And then used to generate apollo client code based on TypeScript and graphql files in the project:

```shell
yarn narrator-graph-codegen --dev
```

This package's output will be in `src/graph/generated` in your project

Suggestions for use in projects:

- Run concurrently with your dev process while working, so changes to queries you're working on trigger codegen right away (the `---watch` flag helps!)
- Run in postinstall and pre-commit hooks, before any other processes
- Update the package frequently! -- version updates here reflect graph schema changes
- Add `src/graph/generated` to your project's `.gitignore`

If you need the whole introspected shema for other purposes you may `require('@narratorai/graph-codegen/generated/graphql.schema.json')`

## The `REF` file

Is autogenerated on commits to the migrations directory

## Testing changes to this package

If you have changes to the codegen package you need to test, you can run it locally from here against a projct that uses codegen, ie:

```
yarn generate
./bin/graph-codegen --cwd ~/Code/portal-narrator-next --root portal
```

And then check the output in `~/Code/portal-narrator-next/portal/graph/generated`
